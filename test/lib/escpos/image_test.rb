require_relative '../../test_helper'

class ImageTest < Minitest::Test
  def setup
    @printer = Escpos::Printer.new
  end

  def test_image
    image_path = File.join(__dir__, '../../fixtures/tux_mono.png')
    image = Escpos::Image.new image_path

    @printer.write image
    @printer.write "\n" * 10
    @printer.cut!
    image.chunky_png_image.metadata = {}
    image.chunky_png_image.save(File.join(__dir__, "../../results/#{__method__}.png"))
    assert_equal @printer.to_base64, 'G0AddjAAEACYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAD///AAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAD////gAAAAAAAAAAAAAAAB////+AAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAf////+AAAAAAAAAAAAAAAP/////gAAAAAAAAAAAAAAH/////8AAAAAAAAAAAAAAB//////gAAAAAAAAAAAAAA//////4AAAAAAAAAAAAAAP//////AAAAAAAAAAAAAAH//////wAAAAAAAAAAAAAB//////8AAAAAAAAAAAAAAf//////gAAAAAAAAAAAAAP//////4AAAAAAAAAAAAAD//////+AAAAAAAAAAAAAA///////gAAAAAAAAAAAAAP//////8AAAAAAAAAAAAAD///////AAAAAAAAAAAAAA////D//wAAAAAAAAAAAAAP///AP/8AAAAAAAAAAAAAH4P/gB//AAAAAAAAAAAAAB8B/wAf/wAAAAAAAAAAAAAfAP8AD/8AAAAAAAAAAAAAHgD+AA//AAAAAAAAAAAAAB4AfgwH/4AAAAAAAAAAAAAeEHweB/+AAAAAAAAAAAAAHjh8Hwf/gAAAAAAAAAAAAA48fD8H/4AAAAAAAAAAAAAOfHw/B/+AAAAAAAAAAAAADnx+Pwf/gAAAAAAAAAAAAA5/w/8H/4AAAAAAAAAAAAAOPgB/B/+AAAAAAAAAAAAADjwAHw//gAAAAAAAAAAAAA8YAAcP/4AAAAAAAAAAAAAPsAAB//+AAAAAAAAAAAAAD8AAAD//gAAAAAAAAAAAAA+AAAAP/4AAAAAAAAAAAAAPAAAAB/+AAAAAAAAAAAAADgAAAAf/gAAAAAAAAAAAAAwAAADH/4AAAAAAAAAAAAAMwAADh/+AAAAAAAAAAAAAHmAABgf/gAAAAAAAAAAAAB4wABgP/4AAAAAAAAAAAAAfDABgH//AAAAAAAAAAAAAH4cBgDP/wAAAAAAAAAAAAB/g/gDD/+AAAAAAAAAAAAA/MAADA//gAAAAAAAAAAAAPwgADAH/8AAAAAAAAAAAAD8EADAB//AAAAAAAAAAAAB/AwBgAf/4AAAAAAAAAAAAfwDDgAD/+AAAAAAAAAAAAP4AAAAA//wAAAAAAAAAAAD+AAAAAP/+AAAAAAAAAAAB/gAAAAB//gAAAAAAAAAAAf4AAAAAf/8AAAAAAAAAAAP8AAAAAH//gAAAAAAAAAAH/AAAAAA//8AAAAAAAAAAD/wAAAAAP//gAAAAAAAAAA/4AAAAAB//4AAAAAAAAAAf+AAAAAAf//AAAAAAAAAAP/gAAAAAH//4AAAAAAAAAH/wAAAAAA///AAAAAAAAAD/8AAAAAAP//4AAAAAAAAA//AAAAAAB//+AAAAAAAAAf/gAAAAAAff/wAAAAAAAAP/4AAAAAAH7/+AAAAAAAAD/8AAAAAAA/f/gAAAAAAAB//AAAAAAAP7/8AAAAAAAA/vgAAAAAAB/f/gAAAAAAAP34AAAAAAAfz/4AAAAAAAH98AAAAAAAD+//AAAAAAAB+/AAAAAAAA/3/wAAAAAAA/vwAAAAAAAH8/+AAAAAAAP34AAAAAAAB/v/gAAAAAAH9+AAAAAAAAP5/8AAAAAAD+/AAAAAAAAD+f/AAAAAAA/vwAAAAAAAAfz/4AAAAAAfz4AAAAAAAAH8/+AAAAAAH9+AAAAAAAAA/P/wAAAAAB+fAAAAAAAAAP5/8AAAAAA/nwAAAAAAAAD+f/AAAAAAP78AAAAAAAAAfn/4AAAAAH8+AAAAAAAAAH5/+AAAAAB/PgAAAAAAAAB+f/gAAAAAfz4AAAAAAAAAPj/4AAAAAP88AAAAAAAAAD4//AAAAAD/PAAAAAAAAAA+P/wAAAAA/jwAAAAAAAAAHj/8AAAAAP48AAAAAAAAABw//AAAAAH+PAAAAAAAAAAMf/wAAAAB/zgAAAAAAAAAAH/8AAAAAf8YAAAAAAAAAAA//AAAAAH/GAAAAAAAAAA8D/wAAAAB/wgAAAAAAAAA54P8AAAAAf+IAAAAAAAAAIDx/AAAAAH/gAAAAAAAAAGAOPwAAAAB/8AAAAAAAAABAB58AAAAAf/AAAAAAAAAAwAPPAAAAAH/4AAAAAAAAAcADzwAAAAB//AAAAAAAAAfAAc4AAAAA4H4AAAAAAAAGYAPuAAAAAcAfAAAAAAAADGAD/gAAAAGAD8AAAAAAAAxgB/8AAAADAA/gAAAAAAAYMB+DwAAABgAH+AAAAAAAGDx/AMAAAA4AA/wAAAAAABgf/gBgAAAcAAH/AAAAAAAwD/gAYAAAeAAB/4AAAAAAMAfgADAAA+AAAP/AAAAAADAAAAAwAA+AAAD/4AAAAAAwAAAAMAAcAAAAf/AAAAAAMAAAABAAOAAAAH/4AAAAADAAAAAYADAAAAA/+AAAAAAwAAAAGABgAAAAP/wAAAAAIAAAABgAYAAAAB/8AAAAAGAAAAAMAGAAAAAf/gAAAABgAAAADABgAAAAD/4AAAAAYAAAAAYAYAAAAA/+AAAAAGAAAAADAGAAAAAH/gAAAABgAAAAA4BgAAAAA/wAAAAAYAAAAAGAYAAAAAH4AAAAAGAAAAAAwDAAAAAB4AAAAADgAAAAAMAwAAAAAOAAAAAAwAAAAABgMAAAAABgAAAAAMAAAAAAYDAAAAAAMAAAAADAAAAAAGBgAAAAABgAAAABgAAAAADgYAAAAAAcAAAAA4AAAAAAwGAAAAAADAAAAA+AAAAAA4BgAAAAAAcAAAA/gAAAAAcAwAAAAAAHwAAA/wAAAAAcAMAAAAAAA/AAB/8AAAAAcADAAAAAAAP/AH//AAAAAcAAwAAAAAAD/////wAAAAcAAOAAAAAAAf////8AAAAcAABgAAAAAAH////+AAAAOAAAMAAAAAAB/////gAAAGAAAB8AAAAAA/////4AAADAAAAH/wAAAAP/gAf/AAABgAAAAH/4AAAD4AAAAwAAAwAAAAAAfgAABgAAAAMAAAYAAAAAAAeAAA4AAAABgAAMAAAAAAAB8AAcAAAAAcAAOAAAAAAAAH4AeAAAAADAAHAAAAAAAAAP/+AAAAAAcAHgAAAAAAAAAf+AAAAAADwPgAAAAAAAAAAAAAAAAAAf/gAAAAAAAAAAAAAAAAAAA/AAAAAAAAAAAAAAAAAAAAAAAAAAACgoKCgoKCgoKCh1WAA=='
  end

  def test_image_conversion
    image_path = File.join(__dir__, '../../fixtures/tux_alpha.png')
    image = Escpos::Image.new image_path, convert_to_monochrome: true

    @printer.write image.to_escpos
    @printer.write "\n" * 10
    @printer.cut!
    image.chunky_png_image.metadata = {}
    image.chunky_png_image.save(File.join(__dir__, "../../results/#{__method__}.png"))
    assert_equal @printer.to_base64, 'G0AddjAAEACYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAF/+gAAAAAAAAAAAAAAAAAP//+AAAAAAAAAAAAAAAAAP///wAAAAAAAAAAAAAAAAH////AAAAAAAAAAAAAAAAH////4AAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAB/////4AAAAAAAAAAAAAAAf/////AAAAAAAAAAAAAAAP/////wAAAAAAAAAAAAAAH/////+AAAAAAAAAAAAAAB//////gAAAAAAAAAAAAAA//////8AAAAAAAAAAAAAAP//////AAAAAAAAAAAAAAD//////4AAAAAAAAAAAAAB//////+AAAAAAAAAAAAAAf//////gAAAAAAAAAAAAAH//////4AAAAAAAAAAAAAB///////AAAAAAAAAAAAAAf//////wAAAAAAAAAAAAAP//////8AAAAAAAAAAAAAB///8H//AAAAAAAAAAAAAA/r/8A//wAAAAAAAAAAAAAHwf+AH/8AAAAAAAAAAAAAD4D/gA//gAAAAAAAAAAAAA8AfwAP/wAAAAAAAAAAAAAHAH8EB/+AAAAAAAAAAAAADwh+Hwf/AAAAAAAAAAAAAA4cPh8H/4AAAAAAAAAAAAAHPD4fg/+AAAAAAAAAAAAADj4+P4f/AAAAAAAAAAAAAAc+fz+H/4AAAAAAAAAAAAAPPvW/h/8AAAAAAAAAAAAABx8Afwf/gAAAAAAAAAAAAAeeAB8P/wAAAAAAAAAAAAAHnAAHj/+AAAAAAAAAAAAAB9AAAN//AAAAAAAAAAAAAAfgAAA//4AAAAAAAAAAAAAHwAAAD/8AAAAAAAAAAAAAB4AAAAf/gAAAAAAAAAAAAAcAAAAH/4AAAAAAAAAAAAAOQAAA4/+AAAAAAAAAAAAABmAAA4f/gAAAAAAAAAAAAA8wAAYH/4AAAAAAAAAAAAAPCAAYD//AAAAAAAAAAAAAD44AcBv/wAAAAAAAAAAAAA/ho8Az/8AAAAAAAAAAAAAf4PwBw//gAAAAAAAAAAAAH5wABwP/4AAAAAAAAAAAAB+EAAwB//AAAAAAAAAAAAA/gwAwAf/wAAAAAAAAAAAAP4GBwAH/+AAAAAAAAAAAAD8AfwAA//wAAAAAAAAAAAB/gAAAAP/8AAAAAAAAAAAA/wAAAAB//gAAAAAAAAAAAP8AAAAAf/8AAAAAAAAAAAH+AAAAAH//gAAAAAAAAAAD/gAAAAA//4AAAAAAAAAAA/4AAAAAP//AAAAAAAAAAAf+AAAAAD//4AAAAAAAAAAP/AAAAAAf//AAAAAAAAAAH/wAAAAAH//4AAAAAAAAAB/4AAAAAA//+AAAAAAAAAA/+AAAAAAP//wAAAAAAAAAf/gAAAAAD//+AAAAAAAAAP/wAAAAAAff/wAAAAAAAAD/8AAAAAAH7/8AAAAAAAAB/+AAAAAAA/f/gAAAAAAAA//gAAAAAAP7/8AAAAAAAAP34AAAAAAB/f/AAAAAAAAH78AAAAAAAf3/4AAAAAAAD+/AAAAAAAD+/+AAAAAAAA/fgAAAAAAA/3/wAAAAAAAf34AAAAAAAH9/+AAAAAAAH78AAAAAAAB/v/gAAAAAAD+/AAAAAAAAP7/8AAAAAAA/fgAAAAAAAD/f/AAAAAAAf34AAAAAAAAf3/wAAAAAAH78AAAAAAAAH8/+AAAAAAD+/AAAAAAAAB/f/gAAAAAA/vwAAAAAAAAP7/8AAAAAAf34AAAAAAAAD+//AAAAAAH8+AAAAAAAAAfn/wAAAAAD/fAAAAAAAAAH5/+AAAAAA/3wAAAAAAAAB+f/gAAAAAP58AAAAAAAAAPn/4AAAAAD+fAAAAAAAAAD5/+AAAAAB/ngAAAAAAAAA+f/wAAAAAf54AAAAAAAAAPH/4AAAAAH+eAAAAAAAAABx//AAAAAD/jgAAAAAAAAAE//wAAAAAf94AAAAAAAAAAH/8AAAAAP+MAAAAAAAAADQf/AAAAAD/zgAAAAAAAAD/j/wAAAAA/8QAAAAAAAAAw+P8AAAAAP/AAAAAAAAAAQD5+AAAAAD/4AAAAAAAAAGAPPwAAAAA//AAAAAAAAADAB54AAAAAP/wAAAAAAAABwAPeAAAAAD/+AAAAAAAAB8AD3gAAAAA4PwAAAAAAAAZgB94AAAAAcB/AAAAAAAAMYAf8AAAAAOAH4AAAAAAADGAP/wAAAAHAB/gAAAAAABgwH6+AAAABgAP8AAAAAAAYPH8BwAAAAwAB/gAAAAAAOB/8AMAAAA8AAP+AAAAAADAf+ABgAAA8AAD/wAAAAAAwB+AAYAAA+AAAf+AAAAAAMAAAAGAAA8AAAH/wAAAAADAAAAAwAAcAAAA/+AAAAAAwAAAAMAAOAAAAP/gAAAAAMAAAADAAHAAAAB/8AAAAAGAAAAAwABgAAAAf/gAAAAAwAAAAGAAYAAAAD/4AAAAAYAAAABgAGAAAAA//AAAAADAAAAAcABgAAAAH/wAAAABgAAAADgAYAAAAA/8AAAAAYAAAAAYAGAAAAAP/AAAAAGAAAAADABgAAAAB/gAAAABgAAAAA4AMAAAAAPwAAAAAYAAAAAGAGAAAAABwAAAAAMAAAAAAwAwAAAAAcAAAAADAAAAAAMAYAAAAADgAAAAAwAAAAADADAAAAAAYAAAAAcAAAAAAwBgAAAAADAAAAAOAAAAAAYAYAAAAAA4AAAAHgAAAAAOAOAAAAAAHAAAAH4AAAAAPABAAAAAAA8AAAH8AAAAAHgAwAAAAAAPwAAP/AAAAAPgAMAAAAAAB/wAf/wAAAAHgADAAAAAAAf////8AAAAPgAAwAAAAAAH/////AAAAHgAAGAAAAAAA/////gAAAHgAABwAAAAAAf////8AAADgAAAPgAAAAAH/////AAABwAAAA/+AAAAB/+pf/gAAA4AAAAC//AAAAfoAAK8AAAcAAAAAAH+AAAOAAAADAAAGAAAAAAAH4AAHAAAAAYAAHAAAAAAAAHgADgAAAAHAADgAAAAAAAA/ADwAAAAAwABwAAAAAAAAB/vwAAAAAHAB4AAAAAAAAAH/wAAAAAA8D4AAAAAAAAAABAAAAAAAH/4AAAAAAAAAAAAAAAAAAAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgoKCgoKCgoKCh1WAA=='
  end

end
